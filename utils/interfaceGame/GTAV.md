# GTA-V Universe
## Common configuration options
The configuration options of the environment are set through the *config.ini* file, in general a -1 value means randomly generated:

* **mode:** 0 for dataset generation, 1 for reinforcement learning [integer]
* **imageWidth:** Width in pixels of the images generated by the plugin [integer]
* **imageHeight:** Height in pixels of the images generated by the plugin [integer]
* **car:** Vehicle to use. For now only blista (Toyota Prius) is supported (0) [integer]
* **weatherChangeDelay:** Time in seconds between weather changes [integer]
* **initialWeather:** Initial weather type [integer]
* **initialHour:** Initial in-game hour [integer]
* **initialMinute:** Initial in-game minute [integer]
* **initialPosX:** Initial x position of the vehicle (will be redefined to closest road) [integer]
* **initialPosY:** Initial y position of the vehicle (will be redefined to closest road) [integer]
* **maxDuration:** Duration in hours of the session [integer]

See *Scenario.cpp* for more details on the supported values, especially for car, drivingStyle and initialWeather.

## Dataset generation description
The in-game screenshots are stored as RGB PNG format, with the specified width and length of the *config.ini* file. These images are named in order of capture from 1 to undefined. Alongside the images, a file named *dataset.txt* contains a row for each image name, with the labels associated to it separated by spaces. The labels are the following, in the same order:

* Speed (m/s)
* Acceleration (m/s2)
* Brake pedal position (0 to 1)
* Steering angle (-1 to 1, left to right)
* Throttle pedal position (-1 to 1, negative is reverse)
* Yaw rate (deg/s)
* Direction (-1 to left, 1 to right)

## Dataset Mirrors(600K images, 42 hours of driving time)
[README](https://docs.google.com/document/d/1c3upen7NsvkAwgxTC9rhAZJr75Zkn3EP2FVf1Ailqww/edit)

[Archive.org](https://archive.org/details/deepdrive-baseline-uint8)
[dropbox](https://www.dropbox.com/s/b6ox0k1w42cn3ca/gtav-42-hours-uint8.tar.gz?dl=0)

File structure
```
HDF5 "train_0000.h5" {
GROUP "/" {
   DATASET "images" {
      DATATYPE  H5T_STD_U32LE
      DATASPACE  SIMPLE { ( 999, 3, 227, 227 ) / ( 999, 3, 227, 227 ) }
   }
   DATASET "targets" {
      DATATYPE  H5T_IEEE_F32LE
      DATASPACE  SIMPLE { ( 999, 6 ) / ( 999, 6 ) }
   }
   DATASET "vehicle_states" {
      DATATYPE  H5T_IEEE_F32LE
      DATASPACE  SIMPLE { ( 999, 6 ) / ( 999, 6 ) }
   }
}
}

```
Getting image of first frame:
```
def show_image_read_from_hdf5_file(img):
    SIZE = 227
    from skimage.viewer import ImageViewer
    img = np.array(img, dtype='u1')
    img = img.transpose((1, 2, 0))
    img = img[:, :, ::-1]
    viewer = ImageViewer(img.reshape(SIZE, SIZE, 3))
    viewer.show()
```
![](https://github.com/wang3303/GTA-V/blob/master/sample.png)

Getting targets and states of first frame
```
#targets
array([-0.230168  , -1.      ,  0.57265699,  0.161715  , -0.052632  ,  
        0.40000001], dtype=float32)
#states
array([-0.131395  , -1.        ,  0.38608   ,  0.024159  , -0.052632  ,
        0.46013099], dtype=float32)
#Metadata (non-pixel data) in the “targets” hdf5 dataset:
#Spin (yaw velocity)
#Direction (1 for left spin, -1 for right spin)
#Speed (velocity in the forward direction of the car, negative velocity represents going in reverse)
#Speed change (change in the above value)
#Steering (steering angle from 1 to -1, right to left, zero is straight ahead)
#Throttle (gas pedal position from 0 to 1)
```

## Install GTA(Have to install this game on Windows since it is a stream game)
[Install instrucitons](https://github.com/openai/universe-windows-envs/blob/master/vnc-gtav/README.md)
## Sample output from the environment
```
{
    "body" :
    {
        "done" : false,
        "info" :
        {
            "center_of_lane_reward" : 0,
            "distance_from_destination" : 1306.6157153344816,
            "forward_vector_x" : -0.9870644211769104,
            "forward_vector_y" : 0.15973846614360809,
            "forward_vector_z" : 0.013689413666725159,
            "game_time.day_of_month" : 6,
            "game_time.hour" : 16,
            "game_time.minute" : 8,
            "game_time.month" : 9,
            "game_time.ms_per_game_min" : 2000,
            "game_time.second" : 47,
            "game_time.year" : 2009,
            "heading" : 80.808067321777344,
            "is_game_driving" : false,
            "last_collision_time" : 1481999559,
            "last_material_collided_with" : "4201905313",
            "on_road" : true,
            "script_hook_loadtime" : 1481939095,
            "speed" : 0,
            "spin" : 0,
            "x_coord" : -2372.70068359375,
            "y_coord" : 1032.6005859375,
            "z_coord" : 195.53288269042969
        },
        "reward" : 0
    },
    "headers" :
    {
        "episode_id" : "1",
        "sent_at" : 1481999938.4742091
    },
    "method" : "v0.env.reward"
}
```
## Sample code
```
import gym
import universe # register Universe environments into Gym
from universe.spaces import joystick_event

env = gym.make('gtav.SaneDriving-v0')
env.configure(remotes='vnc://$host:$port') # point to the GTA V Universe server
observation_n = env.reset()

while True: 
  steer = joystick_event.JoystickAxisXEvent(-1)     # turn right
  throttle = joystick_event.JoystickAxisZEvent(-1)  # go in reverse
  # Alternatively, use WASD to steer: ('KeyEvent', 'w', True)
  action_n = [[steer, throttle] for _ in observation_n]
  observation_n, reward_n, done_n, info = env.step(action_n)
  env.render()
```
## A pretrained agent
[Pretrained agent](https://github.com/deepdrive/deepdrive-universe)
